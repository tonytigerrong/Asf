<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>

<body>
<h5>Demo of DI data into controller from java controller layer</h5>
<!-- 
https://www.undefinednull.com/2014/02/11/mastering-the-scope-of-a-directive-in-angularjs/
https:github.com/json-schema-form/angular-schema-form/blob/development/docs/index.md#basic-usage 

https:www.npmjs.com/package/angular-schema-form 

-->
<script type="text/javascript" src="bower_components/angular/angular.min.js"></script>
	<script type="text/javascript" src="bower_components/angular-sanitize/angular-sanitize.min.js"></script>
	<script type="text/javascript" src="bower_components/tv4/tv4.js"></script>
	<script type="text/javascript" src="bower_components/objectpath/lib/ObjectPath.js"></script>
	<script type="text/javascript" src="bower_components/angular-schema-form/dist/schema-form.min.js"></script>
	<script type="text/javascript" src="bower_components/angular-schema-form/dist/bootstrap-decorator.min.js"></script>
asf demo of promise and asf<br/>
1. handle $http defer by promise.<br/>
2. embed asf into a new directive<br/>
3. trying pass data via scope of directive<br/><br/><br/>
	<div ng-app='mainApp' ng-controller='myCtrl'>
		======  all ====================<br/>
		{{all}}<br/>
		================================<br/>
		<my-asf schema='myCtrl.getSchema()' form='myCtrl.getForm()'></my-asf><br/>
		================================<br/>
		<form sf-schema='schema' sf-form='form'></form>
	</div>
	<script>
		var mainApp = angular.module('mainApp',['schemaForm']);
		var myCtrl = mainApp.controller('myCtrl',function($scope,$http,getFormData){

				getFormData.getSchema().then(function(promise){
					$scope.schema = promise;
					// console.log($scope.schema); // this shoudl output data
				});
				getFormData.getForm().then(function(promise){
					$scope.form = promise;
				});

				// $scope.all = getFormData.getAll().then(function(a){
				// 	$scope.all = a;
				// });
				// $scope.all = {name:'rong'};
				// console.log($scope.schema); // this should output null, cause by asych process execute
				// console.log($scope.form);
				// console.log($scope.all.form);
				// console.log($scope.all.schema);
				// $scope.model = {};
			});

		myCtrl.directive('myAsf',function(){
			var directive = {};
			directive.restrict = 'E';
			directive.templateUrl = "form.html";
			directive.scope = {
				schema: '&',
				form: '&'
			};
			// directive.scope=true;
			// directive.scope=false;
			directive.link = function(scope,elem,attr){
	            console.log(scope);
	        }
			return directive;
		});


		myCtrl.service('getFormData',['$http',function($http){
			this.all = {
				schema:{},
				form:{}
			};
			this.result = {};
			this.getSchema = function(){
				
				var promise = $http.get('./schema.json').then(function(response){
						this.result = response.data;
						return this.result;
				});
				return promise;
			};
			this.getForm = function(){
				
				var promise = $http.get('./form.json').then(function(response){
						this.result = response.data;	
						return this.result;
				});
				return promise;
			};
			// this.getAll = function(){
			// 	var promise = this.getSchema().then(function(response){
			// 			this.all.schema = response.data;
			// 			return this.all.schema;
			// 	});
			// 	promise = this.getForm().then(function(response){
			// 			this.all.form = response.data;
			// 			return this.all.form;
			// 	});
			// 	return promise;
				
			// };
				
		}]);
			
	</script>
</body>
</html>